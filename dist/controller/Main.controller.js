sap.ui.define(["sap/base/assert","sap/ui/core/Fragment","sap/ui/core/XMLTemplateProcessor","gramont/VCDSM/specedit/util/ControllerBase","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,o,a,n,i){"use strict";var s=a.extend("gramont.VCDSM.specedit.controller.Main",{onInit:function(){var e={Specifications:[{SpecId:"000000010382",Description:"test1"},{SpecId:"000000004039",Description:"test2"},{SpecId:"000000004039",Description:"test3"},{SpecId:"000000004039",Description:"test4"},{SpecId:"000000004039",Description:"test5"},{SpecId:"000000004039",Description:"test6"},{SpecId:"000000004039",Description:"test7"},{SpecId:"000000004039",Description:"test8"},{SpecId:"000000010224",Description:"test9"}]};var t=new sap.ui.model.json.JSONModel(e);this.getView().setModel(t);this._iFragIdCounter=0;this._iBusyDialogCounter=0;this._oFragmentContents={};this._setupContentDensity(this.getView());var o=jQuery.sap.getUriParameters().get("Specification");if(o!=null){var a=sap.ui.core.UIComponent.getRouterFor(this);a.navTo("SpecData",{SUBID:o})}else{var n="/sap/opu/odata/GMT/VC_ODATA_SRV";var t=new sap.ui.model.odata.ODataModel(n,true);var i=this;var s={method:"GET",urlParameters:{},context:null,success:function(e){var t=e.results;var o={DOKAR:t[0].DOKAR,DOKNR:t[0].DOKNR,DOKVR:t[0].DOKVR,DOKTL:t[0].DOKTL};var a=i.getOwnerComponent().getComponentConfig().serviceURL+"/DocCollection(DOKAR='"+t[0].DOKAR+"',DOKNR='"+t[0].DOKNR+"',DOKVR='"+t[0].DOKVR+"',DOKTL='"+t[0].DOKTL+"')/$value";i.getView().byId("imglog").setSrc(a)},error:function(e){},async:true};t.callFunction("/GetLogoDoc",s)}},handleValueHelp:function(e){var o="/sap/opu/odata/GMT/VC_ADD_ODATA_SRV";var a=new sap.ui.model.odata.ODataModel(o,true);var n=this;var i=this.getView().byId("mat").getValue();var s={method:"GET",urlParameters:{MATNR_EXT:i},context:null,success:function(e,o){var a=e.results;var i=new sap.ui.model.json.JSONModel(a);n.getView().setModel(i,"matdat");var s=n.getView();if(!n._pValueHelpDialog){n._pValueHelpDialog=t.load({name:"gramont.VCDSM.specedit.frag.MaterialValuehelp",controller:n}).then(function(e){s.addDependent(e);return e})}n._pValueHelpDialog.then(function(e){e.open()});n.getOwnerComponent().getNavigator().releaseBusyDialog()},error:function(e){sap.m.MessageToast.show(e.message);n.getOwnerComponent().getNavigator().releaseBusyDialog()},async:true};a.callFunction("/MatSearchHelp",s);this.getOwnerComponent().getNavigator().requireBusyDialog()},_handleValueHelpSearch:function(e){var t=e.getParameter("value");var o=new n("MATNR",i.Contains,t);e.getSource().getBinding("items").filter([o])},_handleValueHelpClose:function(e){var t=e.getParameter("selectedItem");if(t){var o=this.byId("mat");o.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])},_onpressnav:function(e){var t=e.getParameter("listItem").getTitle();var o=sap.ui.core.UIComponent.getRouterFor(this);o.navTo("SpecData",{SUBID:t})},_oncrtnwspec:function(e){var t=this.getView().byId("mat").getValue();var o="/sap/opu/odata/GMT/VC_ADD_ODATA_SRV";var a=new sap.ui.model.odata.ODataModel(o,true);var n=new sap.ui.model.json.JSONModel;var i=this;var s="'"+t+"'";var r={method:"GET",urlParameters:{MATNR:t},context:null,success:function(e,t){var o=e.results[0].SUBID;if(o==""){sap.m.MessageToast.show(e.results[0].MESSAGE);i.getOwnerComponent().getNavigator().releaseBusyDialog()}else{var a=sap.ui.core.UIComponent.getRouterFor(i);a.navTo("SpecData",{SUBID:o})}},error:function(e,t){sap.m.MessageToast.show(e.message);i.getOwnerComponent().getNavigator().releaseBusyDialog()},async:true};a.callFunction("/CreateSpec",r);this.getOwnerComponent().getNavigator().requireBusyDialog()},navigateTo:function(e,t){this.getOwnerComponent().getRouter().navTo(e,t)},navigateBack:function(){window.history.back()},createFragment:function(a,n,i){var s=this._iFragIdCounter++;var r=this.createId("frag"+s.toString());var l=this.getOwnerComponent().getFragmentName(a);var u=this._oFragmentContents[l];if(!u)u=this._oFragmentContents[l]=o.loadTemplate(l,"fragment");var g={fragmentContent:u,sId:r};var c=sap.ui.xmlfragment(g,n);e(jQuery.type(c)=="object","Fragment should contain only one top-level control");if(c.isA(["sap.m.BusyDialog","sap.m.Dialog","sap.m.Popover","sap.m.TableSelectDialog","sap.m.ViewSettingsDialog"])){if(!i)i=this.getView();i.addDependent(c);this._setupContentDensity(c)}var p=function(e){var o=t.byId(r,e);return o};var D={control:c,byId:p};return D},requireBusyDialog:function(){if(this._iBusyDialogCounter++==0){if(!this._oBusyDialog)this._oBusyDialog=this.createFragment("gramont.VCDSM.specedit.frag.BusyDialog",this);this._oBusyDialog.control.open()}},releaseBusyDialog:function(){e(this._iBusyDialogCounter>0,"iBusyDialogCounter should be > 0");if(--this._iBusyDialogCounter==0){if(this._oBusyDialog.control._oDialog&&this._oBusyDialog.control._oDialog.oPopup&&this._oBusyDialog.control._oDialog.oPopup._oPreviousFocus)this._oBusyDialog.control._oDialog.oPopup._oPreviousFocus=null;this._oBusyDialog.control.close()}},getContentDensityClass:function(){var e=jQuery.device.is.desktop?"sapUiSizeCompact":"";return e},_setupContentDensity:function(e){var t=this.getContentDensityClass();if(t!="")e.addStyleClass(t)}});return s});