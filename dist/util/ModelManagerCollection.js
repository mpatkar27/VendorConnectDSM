sap.ui.define(["sap/base/assert","gramont/VCDSM/specedit/util/ModelManagerAdmin","gramont/VCDSM/specedit/util/ModelManagerAutoGrowOp","gramont/VCDSM/specedit/util/ModelManagerIntStatus","gramont/VCDSM/specedit/util/Util"],function(t,e,o,r,n){"use strict";var i=function(t,e,o,r,n){this._oParentKeyRef=t;this._oModel=e;this._oAdditional=o;this._oCollectionMethods=r;this._oAliveObj=n;this._fAutoGrowHandler=null};i.prototype.getParentKey=function(){var e=null;if(this._oParentKeyRef){var o=this._oCollectionMethods.extractParentKey;t(o,"fExtractParentKey should be set");e=o(this._oParentKeyRef)}return e};i.prototype.getModel=function(){return this._oModel};i.prototype.getAdditional=function(){return this._oAdditional};i.prototype.getEntry=function(t){this._checkEntryIndex(t);var e=this._oModel.getData();var o=e[t];return o};i.prototype.getEntries=function(){var t=this._oModel.getData();return t};i.prototype.setFieldValue=function(t,o,r,i){this._checkEntryIndex(t);n.checkFieldName(o);this._oModel.setProperty("/"+t+"/"+o,r);if(!i)this.updateEntryStatus(t);else this._oModel.setProperty("/"+t+"/"+e.FullPropName.ForceReset,true)};i.prototype.revertEntryToUnchanged=function(o){this._checkEntryIndex(o);var n="/"+o+"/"+e.FullPropName.IntStatus;var i=this._oModel.getProperty(n);var a=i==r.Modified;t(a||i==r.Unchanged,"Entry status should be either Modified or Unchanged");if(a)this._oModel.setProperty(n,r.Unchanged)};i.prototype.updateEntryStatus=function(t){this._checkEntryIndex(t);var n="/"+t+"/"+e.FullPropName.IntStatus;var i=this._oModel.getProperty(n);var a=null;switch(i){case r.Empty:a=r.New;break;case r.Unchanged:a=r.Modified;break}if(a!=null)this._oModel.setProperty(n,a);if(this._oCollectionMethods.create&&t==this._oModel.getData().length-1)this._createAutoGrow(o.New)};i.prototype.getEntryIndexOfControl=function(e){t(e.getModel()==this._oModel,"oControl should be bound to model");var o=e.getBindingContext().getPath().split("/");t(o.length==2&&o[0]=="","Control should have absolute binding context path");var r=parseInt(o[1]);return r};i.prototype.create=function(t){var e=this._callAutoGrowHandler(o.New);this._create(false,e,t)};i.prototype.delete=function(e,o){var r=this._oCollectionMethods.delete;t(r,"delete is not possible");r(this._oParentKeyRef,e,o)};i.prototype.attachChange=function(e){var o=this._oCollectionMethods.attachChange;t(o,"attachChange is not possible");var r=o(this._oParentKeyRef,e);return r};i.prototype.isCreateEnabled=function(){var e=this._oCollectionMethods.isCreateEnabled;t(e,"isCreateEnabled is not possible");var o=e(this._oParentKeyRef);return o};i.prototype.setAutoGrowHandler=function(t){if(!t&&!this._oAliveObj.alive)return;this._createAutoGrow(o.Clear);this._fAutoGrowHandler=t;this._createAutoGrow(o.Set)};i.prototype._create=function(e,o,r){var n=this._oCollectionMethods.create;t(n,"create is not possible");n(this._oParentKeyRef,e,o,r)};i.prototype._createAutoGrow=function(t){var e=this._callAutoGrowHandler(t);this._create(true,e,null)};i.prototype._callAutoGrowHandler=function(t){var e=null;if(this._fAutoGrowHandler)e=this._fAutoGrowHandler(t);return e};i.prototype._checkEntryIndex=function(e){var o=this._oModel.getData().length;t(e<o,"iIndex should be < iLength")};return i});