sap.ui.define(["gramont/VCDSM/specedit/util/SpecDataTabBase","sap/m/library","sap/m/Link","gramont/VCDSM/specedit/util/ModelManagerAdmin","gramont/VCDSM/specedit/util/ModelManagerAutoGrowOp","gramont/VCDSM/specedit/util/ModelManagerIntStatus","gramont/VCDSM/specedit/util/AttachmentDialog","sap/base/assert"],function(e,t,a,n,r,o,s,i){"use strict";var l=function(a,n){e.call(this,a,"gramont.VCDSM.specedit.frag.SpecDataTabAttachment");this._instkey=n;this._oComponent=a;var r=new sap.m.ColumnListItem;var l=this._byId("attachmenttable");var p=this._byId("upldbtn");var g=null;var u=null;var c=function(e){var t=e.getSource().getBindingContext().getPath().split("/");i(t.length==2&&t[0]=="","Control should have absolute binding context path");this._oevent=e;var a=parseInt(t[1]);var n=e.getSource().getModel();var r=n.getData().length;var s="/"+a+"/status";var l=n.getProperty(s);var p=null;switch(l){case o.Empty:p=o.New;break;case o.Unchanged:p=o.Modified;break}if(p!=null)n.setProperty(s,p)};var d=function(e){var t=e.getParameter("requestHeaders");this._event=e;var n={name:"slug",value:e.getParameter("fileName")};t.push(n);var r={name:"Accept",value:"application/json"};t.push(r);var o={name:"x-csrf-token",value:a.getODataManager().getSecurityToken()};t.push(o);a.getNavigator().requireBusyDialog()};var h=function(e){a.getNavigator().releaseBusyDialog();var t=e.getParameter("status");var n=e.getParameter("responseRaw");var r=e.getParameter("fileName");a.getODataManager().parseRawResponse(t,n,"CharEditDocLink.error.upload",jQuery.proxy(v,this,r))};var v=function(e,t){var a=this._oevent;var n=a.getSource().getBindingContext().getPath().split("/");i(n.length==2&&n[0]=="","Control should have absolute binding context path");var r=parseInt(n[1]);var o=a.getSource().getModel();var s="/"+r+"/DOKAR";var l="/"+r+"/DOKNR";var p="/"+r+"/DOKVR";var g="/"+r+"/DOKTL";var u="/"+r+"/FILENAME";o.setProperty(s,t.DOKAR);o.setProperty(l,t.DOKNR);o.setProperty(p,t.DOKVR);o.setProperty(g,t.DOKTL);o.setProperty(u,e)};var m=function(e){var n=e.getSource().getBindingContext().getProperty();var r=a.getODataManager().getDocDownloadURL(n);t.URLHelper.redirect(r,true)};var D=function(e){var t=new s(a,e.getSource().getModel(),l)};p.attachPress(D);var C=this._oComponent.getODataManager().getDocUploadURL();for(var M=0;M<5;M++){if(M==0){g=new sap.m.Label({});g.setText(this._oComponent.getI18nBundle().getText("reqfilat"));u=new sap.m.Column({header:g,mergeDuplicates:true})}else if(M==1){g=new sap.m.Label({});g.setText(this._oComponent.getI18nBundle().getText("fildesc"));u=new sap.m.Column({header:g})}else if(M==2){g=new sap.m.Label({});g.setText(this._oComponent.getI18nBundle().getText("docvalid"));u=new sap.m.Column({header:g})}else if(M==3){g=new sap.m.Label({});g.setText("");u=new sap.m.Column({header:g})}else{g=new sap.ui.core.Icon({src:"sap-icon://delete"});u=new sap.m.Column({header:g})}l.addColumn(u)}r.addCell(new sap.m.Label({text:"{IDENT1}"}));r.addCell(new sap.m.Label({text:"{FILEDESC}"}));r.addCell(new sap.m.DatePicker({change:c}));r.addCell(new sap.m.Link({text:"{FILENAME}",press:m}));r.addCell(new sap.m.CheckBox({selected:"{LOEDK}",select:c}));l.bindItems("/",r,null,null);var f=this._oComponent.getODataManager().requestForFetchDocLink(n);this._oComponent.getODataManager().executeRequest(f,jQuery.proxy(this._fetchdata,this))};l.prototype=Object.create(e.prototype);l.prototype.constructor=l;l.prototype.addProp=function(e){var t=null;var a=this._byId("attachmenttable");this.collection=e;if(e!=null){this._docdata=e.getModel().getData();var n=new sap.ui.model.json.JSONModel(this._docdata);a.setModel(n)}};l.prototype._onSave=function(e){var t=this._byId("attachmenttable");var a=t.getModel().getData();for(var n=0;n<a.length;n++){var r=a[n];if(r.status=="Modified"){var o=this._oComponent.getODataManager().requestForUpdatedoclink(r);this._oComponent.getODataManager().executeRequest(o,jQuery.proxy(this._Success,this))}}};l.prototype._Success=function(e){var t=e;if(t.statusCode==200){sap.m.MessageToast.show(this._oComponent.getI18nBundle().getText("chagsavucc"));var a=this._oComponent.getODataManager().requestForFetchDocLink(this._instkey);this._oComponent.getODataManager().executeRequest(a,jQuery.proxy(this._fetchdata,this))}else{sap.m.MessageToast.show(this._oComponent.getI18nBundle().getText("docvalid"))}};l.prototype._fetchdata=function(e){var t=this._byId("attachmenttable");var a=e;for(var n=0;n<a.entries.length;n++){a.entries[n].status="Unchanged"}var r=new sap.ui.model.json.JSONModel(a.entries);t.setModel(r)};return l});