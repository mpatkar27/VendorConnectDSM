sap.ui.define(["sap/base/assert","sap/ui/model/Filter","sap/ui/model/FilterOperator","gramont/VCDSM/specedit/util/ModelManagerAutoGrowOp","gramont/VCDSM/specedit/util/ModelManagerStatus","gramont/VCDSM/specedit/util/TableManager","gramont/VCDSM/specedit/util/ValueHelperDialog"],function(e,t,o,a,i,s,n){"use strict";var r=function(e){e.initClassExtension(this,"gramont.VCDSM.specedit.util.CharEditUserDefinedText",arguments);this._oComponent=e;this._oDialog=this._oComponent.getNavigator().createFragment("gramont.VCDSM.specedit.frag.CharEditUserDefinedText",this);var t=this._oDialog.byId("table");var o=this._oDialog.byId("table.item");this._oTableManager=new s(this._oComponent,t,o);this._oValueHelperPropMaps={LANGU:{LANGU:{property:"SPRAS"}}};var a=false;if(this._extHookDisplayLongText)a=this._extHookDisplayLongText();this._oDialog.byId("table.text.std").setVisible(!a);this._oDialog.byId("table.text.long").setVisible(a)};r.prototype.open=function(e,t,o){this._oCharHeader=e;this._oInstance=t;this._fOnStore=o;this._fetchData()};r.prototype._fetchData=function(){var e=this._oComponent.getModelManager().requestForFetchUserDefinedTextByInstanceKey(this._oInstance);this._oComponent.getModelManager().executeFetchRequest(e,jQuery.proxy(this._fetchDataSuccess,this))};r.prototype._fetchDataSuccess=function(a){this._oCollection=a;e(this._oCollection,"oCollection should be set");this._oCollection.setAutoGrowHandler(jQuery.proxy(this._autoGrowHandler,this));this._oTableManager.setCollection(this._oCollection);var i=this._oCharHeader.getTextType();var s=new t({path:"TEXTCAT",operator:o.EQ,value1:i});this._oTableManager.setFilter(s);e(!this._oDialog.control.isOpen(),"oDialog should be closed");this._oDialog.control.open()};r.prototype._autoGrowHandler=function(t){var o=null;switch(t){case a.Set:case a.New:o={TEXTCAT:this._oCharHeader.getTextType()};break;case a.Clear:o={TEXTCAT:null};break;default:e(false,"sAutoGrowOp is unknown")}return o};r.prototype._onCreate=function(){this._oCollection.create(null)};r.prototype._onValueHelpRequest=function(e){n.openDialog(this._oComponent,"UserDefinedText",this._oValueHelperPropMaps,null,e.getSource(),this._oCollection)};r.prototype._onClose=function(){this._oDialog.control.close();this._oCollection.setAutoGrowHandler(null);var t=this._oCharHeader.getTextType();var o=this._oComponent.getConfig().language;var a=this._oCollection.getEntries();var s=[];for(var n=0;n<a.length;n++){var r=a[n];var l=this._oComponent.getModelManager().getEntryStatus(r);switch(l){case i.Empty:case i.Deleted:break;case i.New:case i.Modified:case i.Unchanged:if(r.TEXTCAT==t&&(r.LANGU==null||r.LANGU==""||r.LANGU==o))s.push(r.TEXT);break;default:e(false,"sStatus is unknown")}}var h=this._oCharHeader.buildCharValues(s);this._fOnStore(h,true)};return r});