sap.ui.define(["sap/base/assert","sap/m/Button","sap/m/Text","gramont/VCDSM/specedit/control/CharValueControl","gramont/VCDSM/specedit/control/ExpandVerticalLayout","gramont/VCDSM/specedit/control/Field","gramont/VCDSM/specedit/util/CharEditCommon","gramont/VCDSM/specedit/util/CharHeaderBaseConst","gramont/VCDSM/specedit/util/TableManagerConst"],function(e,t,r,a,i,l,o,s,n){"use strict";var u="_editable";var h=function(e,t){e.initClassExtension(this,"gramont.VCDSM.specedit.util.CharHeaderBase",arguments);this._oComponent=e;this._sFieldName=t.ATNAM;this._sLabel=t.ATBEZ;this._bIsNewEditable=t.IS_NEW_EDITABLE;this._bIsMultiValue=t.FLG_IS_NO_SINGLE_VALUE;this._bHaveValueHelper=!t.FLG_TEMP_CHARAC;this._bHaveAdditionalValues=t.IS_ADDVAL;this._sHelp=t.HELP;this._isCheckBox=t.IS_CHECK_BOX;this._valuehelppresent=t.FLG_VALHELP_EXISTS;this._coledit=t.COL_EDITABLE;this._datatype=t.ATFOR;this._datalength=t.ANZST;this._Linked_prop=t.LINKED_PROP};h.prototype.getFieldName=function(){return this._sFieldName};h.prototype.getLabel=function(){return this._sLabel};h.prototype.getMultiValue=function(){return this._bIsMultiValue};h.prototype.getValueHelper=function(){return this._bHaveValueHelper};h.prototype.getAdditionalValues=function(){return this._bHaveAdditionalValues};h.prototype.getHelp=function(){return this._sHelp};h.prototype.parseCharValues=function(t,r){e(t.FIELDNAME==this._sFieldName,"Fieldname mismatch");var a=t.FIELDVALUE;var i=[];if(a!=""){var l=this._bIsMultiValue?a.split(s.FieldValueSep):[a];for(var o=0;o<l.length;o++){var n=l[o];var u=this._parseCharValue(n);i.push(u)}}if(!this._bIsMultiValue&&i.length==0){if(this._isCheckBox)var u=false;else var u=this._emptyCharValue();i.push(u)}r[this._sFieldName]=i;this._storeEditable(r,t.IS_EDITABLE)};h.prototype.convertCharValues=function(e){var t=e[this._sFieldName];var r=[];for(var a=0;a<t.length;a++){var i=t[a];if(!this._isEmptyCharValue(i)){var l=this._convertCharValue(i);r.push(l)}}var o;if(!this._bIsMultiValue){if(this._isCheckBox==true){if(i.value==true)o="X";else o=""}else{o=r.length==1?r[0]:""}}else{if(this._isCheckBox==true){if(i.value==true)o="X";else o=""}else{o=r.join(s.FieldValueSep)}}var n={FIELDNAME:this._sFieldName,FIELDVALUE:o};return n};h.prototype.createEmptyCharValues=function(e){var t=[];if(!this._bIsMultiValue){var r=this._emptyCharValue();t.push(r)}e[this._sFieldName]=t;this._storeEditable(e,this._bIsNewEditable)};h.prototype.getEditable=function(t){var r=t[u][this._sFieldName];e(r!=null,"bEditable should be set");return r};h.prototype.getControl=function(r,i){var o=u+"/"+this._sFieldName;var s=null;var h=false;if(!this._bIsMultiValue){var p=this._createDisplayValueControlSingleTemplate();var d=this._getCharValueInput(o,this._sFieldName+"/0");var _=false;if(d){_={path:"appModel>/editMode"};d.data(n.FieldName,this._sFieldName);h=true}s=new l({editMode:_,display:p,edit:d})}else{s=this._createDisplayValueControlMulti(r)}e(s,"oInnerControl should be set");var C=this;var c=function(e){if(i)i(C,e)};if(this._isCheckBox!=true&&this._valuehelppresent=="X"){var V=new t({icon:"sap-icon://value-help",enabled:{path:"appModel>/editMode",formatter:jQuery.proxy(this._editButtonEnabledFormatter,this,this._isEditButtonAlwaysEnabled())},visible:{path:"appModel>/editMode",formatter:jQuery.proxy(this._editButtonEnabledFormatter,this,this._isEditButtonAlwaysEnabled())},press:c});var f=new a({innerControl:s,editButton:V})}else{var f=new a({innerControl:s})}if(!this._bIsMultiValue){f.bindProperty("showSeparator",{parts:[{path:"appModel>/editMode"},{path:this._sFieldName}],formatter:jQuery.proxy(this._charValueControlSingleVisibleFormatter,this,h)});s.bindProperty("visible",{parts:[{path:"appModel>/editMode"},{path:this._sFieldName}],formatter:jQuery.proxy(this._charValueControlSingleVisibleFormatter,this,h)})}else{f.bindProperty("showSeparator",{path:this._sFieldName,formatter:jQuery.proxy(this._charValueControlMultiVisibleFormatter,this)});s.bindProperty("visible",{path:this._sFieldName,formatter:jQuery.proxy(this._charValueControlMultiVisibleFormatter,this)});if(this._isCheckBox!=true&&this._valuehelppresent=="X"){V.data(n.FieldName,this._sFieldName)}}return f};h.prototype.parseCharEntry=function(e){var t=e.VALUE;var r=e.DESCR;var a=this._parseCharValueOfCharEntry(t,r);var i=this._makeCharEntryFromCharValue(a,r);if(this._extHookParseCharEntry)this._extHookParseCharEntry(e,i);return i};h.prototype.createCharEntryFromCharValue=function(e){var t=this._createCharEntryFromCharValue(e);return t};h.prototype.createEmptyCharEntry=function(e){var t=this._emptyCharValue();var r=this._makeCharEntryFromCharValue(t,e!=null?e:"");return r};h.prototype.createCharValuesFromCharEntries=function(e){var t=[];for(var r=0;r<e.length;r++){var a=e[r];var i=a.charValue;if(!this._isEmptyCharValue(i))t.push(i)}if(!this._bIsMultiValue&&t.length==0){var i=this._emptyCharValue();t.push(i)}return t};h.prototype.getCharEntryInput=function(){var e=this._getCharValueInput(null,"charValue");return e};h.prototype.getCharEntryLabel=function(){var e=new r({wrapping:false,text:{path:"charValue",formatter:jQuery.proxy(this._formatterForCharValue,this,false)}});return e};h.prototype.getCharEntryFilterPath=function(){var e=this._getCharEntryFilterPath();if(e!=null)e="charValue"+(e!=""?"/"+e:"");return e};h.prototype.openEdit=function(e,t){if(!this._oEditDialog)this._oEditDialog=this._createEditDialog();this._oEditDialog.open(this,e,t)};h.prototype.isEmptyCharValue=function(e){var t=this._isEmptyCharValue(e);return t};h.prototype.isCharValueEqual=function(e,t){var r=this._isCharValueEqual(e,t);return r};h.prototype.createCharValuesFromValueHelperValues=function(e,t){var r=[];for(var a=0;a<e.length;a++){var i=e[a];var l=this._createCharValueFromValueHelperValue(i,t);if(l!=null&&!this._isEmptyCharValue(l))r.push(l)}if(!this._bIsMultiValue&&r.length==0){var l=this._emptyCharValue();r.push(l)}return r};h.prototype.fetchValueHelperFirst=function(){return true};h.prototype._createDisplayValueControlMulti=function(e){var t=this._createDisplayValueControlMultiTemplate();var r=new i({collapseLimit:e,content:{path:this._sFieldName,template:t,templateShareable:false}});return r};h.prototype._createDisplayValueControlSingleTemplate=function(){var e=this._sFieldName+"/0";var t=this._createDisplayValueControlSingleTemplateImpl(e);if(this._extHookCreateDisplayValueControlSingleTemplate)t=this._extHookCreateDisplayValueControlSingleTemplate(e,t);return t};h.prototype._createDisplayValueControlMultiTemplate=function(){var e=this._createDisplayValueControlMultiTemplateImpl();if(this._extHookCreateDisplayValueControlMultiTemplate)e=this._extHookCreateDisplayValueControlMultiTemplate(e);return e};h.prototype._charValueControlSingleVisibleFormatter=function(t,r,a){e(a.length==1,"Should be a single-value characteristic");var i=a[0];var l=!this._isEmptyCharValue(i)||r&&t;return l};h.prototype._charValueControlMultiVisibleFormatter=function(e){var t=e.length>0;return t};h.prototype._editButtonEnabledFormatter=function(e,t){var r=t||e;return r};h.prototype._editButtonVisibleFormatter=function(e){var t=e&&this._bHaveValueHelper;return t};h.prototype._calculateCharValueInputWidth=function(){var e=10;if(this._sFieldName.indexOf("__STDVAI_")==0)e=5;var t=e.toString()+"rem";if(this._extHookCalculateCharValueInputWidth)t=this._extHookCalculateCharValueInputWidth(t);return t};h.prototype._makeCharEntryFromCharValue=function(e,t){var r={charValue:e,description:t};return r};h.prototype._storeEditable=function(e,t){if(!e[u])e[u]={};e[u][this._sFieldName]=t};h.prototype._calculateEnabledBinding=function(e){var t=e!=null?{path:e}:true;return t};h.prototype._getCharValueInput=function(t,r){var a=this._getCharValueInputImpl(t,r);if(this._extHookGetCharValueInput)a=this._extHookGetCharValueInput(t,r,a);if(t==null)e(a,"oControl should be set");return a};h.prototype._parseCharValue=function(t){e(false,"_parseCharValue should be overridden in derived class")};h.prototype._convertCharValue=function(t){e(false,"_convertCharValue should be overridden in derived class")};h.prototype._emptyCharValue=function(){e(false,"_emptyCharValue should be overridden in derived class")};h.prototype._isEmptyCharValue=function(t){e(false,"_isEmptyCharValue should be overridden in derived class")};h.prototype._isCharValueEqual=function(t,r){e(false,"_isCharValueEqual should be overridden in derived class")};h.prototype._getCharValueInputImpl=function(t,r){e(false,"_getCharValueInputImpl should be overridden in derived class")};h.prototype._createDisplayValueControlSingleTemplateImpl=function(e){if(this._isCheckBox==false){var t=new r({wrapping:false});t.bindProperty("text",{path:e,formatter:jQuery.proxy(this._formatterForCharValue,this,true)})}else{var t=new sap.m.Switch({customTextOn:"Yes",customTextOff:"No",state:{path:e+"/value"},enabled:false})}return t};h.prototype._createDisplayValueControlMultiTemplateImpl=function(){var e=new r({wrapping:false});e.bindProperty("text",{path:"",formatter:jQuery.proxy(this._formatterForCharValue,this,true)});return e};h.prototype._formatterForCharValue=function(t,r){e(false,"_formatterForCharValue should be overridden in derived class")};h.prototype._parseCharValueOfCharEntry=function(t,r){e(false,"_parseCharValueOfCharEntry should be overridden in derived class")};h.prototype._createCharEntryFromCharValue=function(t){e(false,"_createCharEntryFromCharValue should be overridden in derived class")};h.prototype._getCharEntryFilterPath=function(){e(false,"_getCharEntryFilterPath should be overridden in derived class")};h.prototype._createCharValueFromValueHelperValue=function(t,r){e(false,"_createCharValueFromValueHelperValue should be overridden in derived class")};h.prototype._isEditButtonAlwaysEnabled=function(){return false};h.prototype._createEditDialog=function(){var e=new o(this._oComponent);return e};return h});