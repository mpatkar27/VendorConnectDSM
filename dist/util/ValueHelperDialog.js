sap.ui.define(["sap/base/assert","sap/ui/model/json/JSONModel","gramont/VCDSM/specedit/util/Util"],function(e,t,a){"use strict";var o=function(e,a,o,r){this._oComponent=e;this._oValueHelperKey=a;this._oInputParams=o;this._fOnConfirm=r;this._oDialog=this._oComponent.getNavigator().createFragment("gramont.VCDSM.specedit.frag.ValueHelperDialog",this);this._oDialogModel=new t;this._oDialog.control.setModel(this._oDialogModel)};o.prototype.open=function(){e(!this._bOpenInvoked,"bOpenInvoked shouldn't be set");this._bOpenInvoked=true;this._fetchValueHelper()};o.prototype._fetchValueHelper=function(){var e=this._oComponent.getODataManager().requestForFetchValueHelper(this._oValueHelperKey,null,this._oInputParams);this._oComponent.getODataManager().executeRequest(e,jQuery.proxy(this._fetchValueHelperSuccess,this))};o.prototype._fetchValueHelperSuccess=function(e){var t=a.buildValueHelperHeaderAndTemplate(e);var o=t.headerColumns;for(var r=0;r<o.length;r++){var n=o[r];this._oDialog.control.addColumn(n)}this._oDialog.control.bindItems("/",t.template);this._aHeaderPropNames=t.headerPropNames;this._oDialogModel.setData(e.entries);this._oDialog.control.open()};o.prototype._destroyDialog=function(){this._oDialog.control.destroy()};o.prototype._onConfirm=function(e){this._destroyDialog();var t=e.getParameter("selectedItem").getBindingContext().getProperty();if(this._fOnConfirm)this._fOnConfirm(t)};o.prototype._onCancel=function(){this._destroyDialog()};o.prototype._onLiveChange=function(e){var t=e.getParameter("value");var o=this._oDialog.control.getBinding("items");var r=a.createSearchFilter(t,this._aHeaderPropNames);o.filter(r?[r]:[])};o.openDialog=function(t,a,r,n,i,l,s){if(!r)r={};if(!n)n={};e(i.isA("sap.m.Input"),"oControl should be instance of sap.m.Input");var p;var u;if(l){p=l.getEntryIndexOfControl(i);u=i.getBindingPath("value")}else{var h=i.getBindingPath("value").split("/");e(h.length==2&&h[0]=="","Control should have absolute binding context path");u=h[0]}var v={entityName:a,fieldName:u};var f=n[u];var g=function(t){var a=r[u];var o=[];switch(jQuery.type(a)){case"null":case"undefined":var n={fieldName:u,value:t[u]};o.push(n);break;case"array":for(var h=0;h<a.length;h++){var v=a[h];var n={fieldName:v,value:t[v]};o.push(n)}break;case"object":for(var v in a){var f=a[v];var g;if(f.property!=null)g=t[f.property];else if(f.value!=null)g=f.value;else e(false,"unknown mapping");var n={fieldName:v,value:g};o.push(n)}break;default:e(false,"Unknown vPropMap type")}if(l){for(var h=0;h<o.length;h++){var n=o[h];l.setFieldValue(p,n.fieldName,n.value)}}else{var d=i.getModel();var c=i.getBindingContext().getPath().split("/");var m=parseInt(c[1]);for(var h=0;h<o.length;h++){var n=o[h];d.setProperty("/"+m+"/"+n.fieldName,n.value);d.setProperty("/"+m+"/Change",true)}}if(s)s(i,u)};var d=new o(t,v,f,g);d.open()};return o});