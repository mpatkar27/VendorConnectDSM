sap.ui.define(["gramont/VCDSM/specedit/util/SpecDataTabBase","sap/m/library","sap/m/Link","gramont/VCDSM/specedit/util/SpecDataTabAttachment","gramont/VCDSM/specedit/util/ModelManagerAdmin","gramont/VCDSM/specedit/util/ModelManagerAutoGrowOp","gramont/VCDSM/specedit/util/ModelManagerIntStatus","sap/ui/model/json/JSONModel","sap/base/assert"],function(t,e,o,a,i,s,r,n,l){"use strict";var d=function(e,o,a){t.call(this,e,"gramont.VCDSM.specedit.frag.AttachmentDialog");this._atttab=a;this._oComponent=e;this._collection=o;this._oDialog=e.getNavigator().createFragment("gramont.VCDSM.specedit.frag.AttachmentDialog",this);this._oDialogDialogModel=new n;this._oDialog.control.setModel(this._oDialogDialogModel,"dialogModel");var i=this._oDialog.byId("selectfsub");this._subtxt=null;this._subky=null;this._desc=null;this._evef=null;this._dat=null;var s=this._oComponent.getODataManager().getDocUploadURL();this._upldr=this._oDialog.byId("uploaderd");this._upldr.setUploadUrl(s);this._omod=new n;i.setModel(this._omod);var r=o.getData();var l=[],d=0,u=[];for(var p=0;p<r.length;p++){if(p!=0){if(r[p].SUBID!=r[p-1].SUBID){u["SUBID"]=r[p].SUBID;u["IDENT1"]=r[p].IDENT1;l[d]=jQuery.extend({},u);d++}}else{u["SUBID"]=r[p].SUBID;u["IDENT1"]=r[p].IDENT1;l[d]=jQuery.extend({},u);d++}}this._omod.setData(l);this._oDialog.control.open()};d.prototype=Object.create(t.prototype);d.prototype.constructor=d;d.prototype._onupld=function(){this._subtxt=this._oDialog.byId("selectfsub")._getSelectedItemText();this._subky=this._oDialog.byId("selectfsub").getSelectedKey();this._desc=this._oDialog.byId("inpdesc").getValue();this._upldr=this._oDialog.byId("uploaderd");var t=this._upldr.getValue()+"/"+this._desc;var e=new sap.ui.unified.FileUploaderParameter;var o=new sap.ui.unified.FileUploaderParameter;var a=new sap.ui.unified.FileUploaderParameter;e.setName("slug");e.setValue(t);o.setName("Accept");o.setValue("application/json");a.setName("x-csrf-token");a.setValue(this._oComponent.getODataManager().getSecurityToken());this._upldr.addHeaderParameter(e);this._upldr.addHeaderParameter(o);this._upldr.addHeaderParameter(a);this._upldr.upload();this._oComponent.getNavigator().requireBusyDialog()};d.prototype._onClose=function(){this._oDialog.control.close()};d.prototype._onUploadComplete=function(t){this._oComponent.getNavigator().releaseBusyDialog();var e=t.getParameter("status");var o=t.getParameter("responseRaw");var a=t.getParameter("fileName");this._oComponent.getODataManager().parseRawResponse(e,o,"CharEditDocLink.error.upload",jQuery.proxy(this._onUploadCompleteSuccess,this,a))};d.prototype._onUploadCompleteSuccess=function(t,e){var o=this._oevent;var a=this._collection.getData().length;var i=this._collection.getData();for(var s=0;s<i.length;s++){if(i[s].SUBID==this._subky){var n=jQuery.extend(true,{},i[s])}}n.SUBID=this._subky;n.IDENT1=this._subtxt;n.FILEDESC=this._desc;n.DOKAR=e.DOKAR;n.DOKNR=e.DOKNR;n.DOKVR=e.DOKVR;n.DOKTL=e.DOKTL;n.FILENAME=t;n.LOEDK=false;n.status=r.Modified;i[a]=jQuery.extend({},n);i.sort(function(t,e){if(t.SUBID===e.SUBID)return 0;return t.SUBID>e.SUBID?1:-1});this._collection.setData(i);this._atttab.setModel(this._collection);this._oDialog.control.close()};d.prototype._docopen=function(t){var o=t.getSource().getBindingContext().getProperty();var a=this._oComponent.getODataManager().getDocDownloadURL(o);e.URLHelper.redirect(a,true)};d.prototype._onChangesel=function(t){this._subtxt=t.getSource()._getSelectedItemText();this._subky=t.getSource().getSelectedKey()};d.prototype._onChangedat=function(t){this._dat=t.getSource().getValue()};d.prototype._onChange=function(t){};d.prototype._onChangedes=function(t){this._desc=t.getSource().getValue()};return d});