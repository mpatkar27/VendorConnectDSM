sap.ui.define(["gramont/VCDSM/specedit/util/SpecDataTabBase","sap/m/library","sap/m/Link","gramont/VCDSM/specedit/util/ModelManagerAdmin","gramont/VCDSM/specedit/util/ModelManagerAutoGrowOp","gramont/VCDSM/specedit/util/ModelManagerIntStatus","sap/ui/model/json/JSONModel","gramont/VCDSM/specedit/util/PropMultiComposition","sap/base/assert","gramont/VCDSM/specedit/util/ValueHelperDialog"],function(t,e,o,a,i,s,r,n,p,l){"use strict";var h=function(e,o,a){t.call(this,e,"gramont.VCDSM.specedit.frag.UsageDiag");this._oComponent=e;this._vhiIndex=null;this._rowmod=null;this._usagecollection=null;this._udtmod=o;this._treenode=a;this._panel1=this._byId("pnl1");this._spec=this._byId("specinp");this._specdet=this._byId("specdetinp");this._oDialogadd=e.getNavigator().createFragment("gramont.VCDSM.specedit.frag.UsageDiag",this);this._Odiagrestab=new r;this._oValueHelperPropMaps={VACLID:{VACLID:{property:"VACLID"},VACLNAM:{property:"VACLNAM"}},RVLID:{RVLID:{property:"RVLID"},RVLNAM:{property:"RVLNAM"}}};this._oDialogadd.control.setModel(this._Odiagrestab);this._oDialogadd.control.open();var i=[{ACTN:"",ACTN_VP:"",RECN_VP:"",RECNROOT:"",RECNPARENT:"",ESTCAT:""}];i[0].ACTN=o.ACTN;i[0].ACTN_VP=o.ACTN_VP;i[0].RECN_VP=o.RECN_VP;i[0].RECNROOT=o.RECNROOT;i[0].RECNPARENT=o.RECNPARENT;i[0].ESTCAT=a.ESTCAT;var s=this._oComponent.getODataManager().requestForFetcUsageDetails(i[0]);this._oComponent.getODataManager().executeRequest(s,jQuery.proxy(this._fetchCharValueSuccess,this))};h.prototype=Object.create(t.prototype);h.prototype.constructor=h;h.prototype._onCloseusag=function(){this._oDialogadd.control.close()};h.prototype._onchange=function(t){var e=t.getSource().getBindingContext().getPath().split("/");var o=parseInt(e[1]);var a=t.getSource().getModel();this._modtab=a;var i="/"+o+"/Change";var s=a.setProperty(i,true)};h.prototype._onok=function(t){var e=this._modtab.getData();for(var o=0;o<e.length;o++){if(e[o].Change==true){e[o].ESTCAT=this._treenode.ESTCAT;e[o].RECNROOT=this._treenode.RECNROOT;e[o].RECNMST=this._udtmod.RECN_VP;e[o].RECNPARENT=this._udtmod.RECNPARENT;var a=this._oComponent.getODataManager().requestForUpdateUsagedat(e[o]);this._oComponent.getODataManager().executeRequest(a,jQuery.proxy(this._onCloseusag,this))}}};h.prototype._fetchCharValueSuccess=function(t){this._usagecollection=t.entries;this._Odiagrestab.setProperty("/",t.entries);this._modtab=this._Odiagrestab};h.prototype._onValueHelpRequestVAC=function(t){var e=t.getSource().getBindingContext().getPath().split("/");this._vhiIndex=parseInt(e[1]);var o=t.getSource().getModel();var a="/"+this._vhiIndex+"/";this._rowmod=o.getProperty(a);l.openDialog(this._getOwnerComponent(),"Status",this._oValueHelperPropMaps,null,t.getSource(),null,jQuery.proxy(this._onValueHelpRequestSelect,this))};h.prototype._onValueHelpRequestSelect=function(t,e){if(e=="VACLID")this._updateFlagSingle(t)};h.prototype._updateFlagSingle=function(t){var e=this._rowmod.VACLID;if(e!=null&&e.trim()!=""){var o=this._usagecollection;for(var a=0;a<o.length;a++){var i=o[a];if(a!=this._vhiIndex&&this._rowmod.VACLID==e){this._oCollection.setFieldValue(this._vhiIndex,"ACTVFLG",i.ACTVFLG);this._oCollection.setFieldValue(this._vhiIndex,"ESNTFLG",i.ESNTFLG);break}}}};return h});