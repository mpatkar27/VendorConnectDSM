sap.ui.define(["gramont/VCDSM/specedit/util/SpecDataTabBase","sap/m/library","sap/m/Link","gramont/VCDSM/specedit/util/ModelManagerAdmin","gramont/VCDSM/specedit/util/ModelManagerAutoGrowOp","gramont/VCDSM/specedit/util/ModelManagerIntStatus","sap/ui/model/json/JSONModel","gramont/VCDSM/specedit/util/PropMultiComposition","sap/base/assert"],function(e,t,o,r,a,i,n,s,M){"use strict";var l=function(t,o,r,a,i,s,M,l){e.call(this,t,"gramont.VCDSM.specedit.frag.MultilevelAdd");this.speckey=M;this.estcat=l;this._oComponent=t;this._obref=s;this._childnodepath=o;this._compnewr=r;this._acompsr=a;this._panel1=this._byId("pnl1");this._panel2=this._byId("pnl2");this._childnode=i;this._spec=this._byId("specinp");this._specdet=this._byId("specdetinp");this._oDialogadd=t.getNavigator().createFragment("gramont.VCDSM.specedit.frag.MultilevelAdd",this);this._oDialogDialogModel=new n;this._Odiagrestab=new n;this._oDialogDialogModel.setProperty("/aData",[{}]);this._Odiagrestab.setProperty("/aData",[]);this._oDialogDialogModel.setProperty("/AdvSrchPanel1Expanded",true);this._oDialogDialogModel.setProperty("/AdvSrchPanel2Expanded",false);this._oDialogadd.control.setModel(this._oDialogDialogModel,"dialogModel");this._oDialogadd.control.setModel(this._Odiagrestab,"resModel");this._oDialogadd.control.open()};l.prototype=Object.create(e.prototype);l.prototype.constructor=l;l.prototype._onClose=function(){this._oDialogadd.control.close()};l.prototype._onaddnode=function(e){var t=e.getParameters().rowBindingContext.getPath();var o=e.getParameters().rowBindingContext.getModel();var r=o.getProperty(t);var a=[],n=[],s=[];var M=this._acompsr.getData();var l=this._compnewr.getProperty(this._childnodepath);a=jQuery.extend(true,{},l);var d=a;if(this._childnode){a.ACTN="";a.CHILD_KEY="0";a.EXP_LEVEL=a.EXP_LEVEL+1;a.IDENT1=r.IDENT_DESCR1;a.NoofChildnodes=0;a.ORD=(d.NoofChildnodes+1).toString();a.PARENT_KEY=d.ITEM_KEY;a.ITEM_KEY="";a.RECN="";a.RECNPARENT="";a.SUBID=r.SUBID;a.aCompositions=[];l.NoofChildnodes=l.NoofChildnodes+1;a.COMPAVG=0;a.DELFLG=""}else{if(l!=null){a.ACTN="";a.CHILD_KEY="0";a.EXP_LEVEL=1;a.IDENT1=r.IDENT_DESCR1;a.ITEM_KEY="";a.NoofChildnodes=0;a.ORD=this._compnewr.getData().length.toString();a.PARENT_KEY="0";a.RECN="";a.RECNPARENT="";a.SUBID=r.SUBID;a.aCompositions=[];l.NoofChildnodes=0;a.COMPAVG=0;a.DELFLG=""}else{a.ABS_QTY="";a.ACTN=this.speckey.ACTN;a.ACTN_VP="0";a.ADDCHDBTN=true;a.CHILD_KEY="0";a.COMPAVG="0.0000";a.COMPCAT="COMPONENT";a.COMPNAM="Component";a.COUNTRY_ORIG="";a.DELFLG="";a.ESTCAT=this.estcat;a.EXP_LEVEL=1;a.IDENT1=r.IDENT_DESCR1;a.ITEM_KEY="";a.ITOTVALVIS0=true;a.ITOTVALVIS1=false;a.ITOTVALVIS2=false;a.ITOTVALVIS3=false;a.NoofChildnodes=0;a.ORD="0001";a.PARENT_KEY="0";a.RECN="";a.RECNPARENT="";a.RECNROOT=this.speckey.RECNROOT;a.RECN_VP="";a.ROW_KEY="0000";a.SORTNO="0000";a.SUBID=r.SUBID;a.UOM="";a.aCompositions=[]}}if(a.EXP_LEVEL==1){a.ITOTVALVIS0=true;a.ITOTVALVIS1=false;a.ITOTVALVIS2=false;a.ITOTVALVIS3=false;a.ADDCHDBTN=true}else if(a.EXP_LEVEL==2){a.ITOTVALVIS0=false;a.ITOTVALVIS1=true;a.ITOTVALVIS2=false;a.ITOTVALVIS3=false;a.ADDCHDBTN=true}else if(a.EXP_LEVEL==3){a.ITOTVALVIS0=false;a.ITOTVALVIS1=false;a.ITOTVALVIS2=true;a.ITOTVALVIS3=false;a.ADDCHDBTN=true}else if(a.EXP_LEVEL==4){a.ITOTVALVIS0=false;a.ITOTVALVIS1=false;a.ITOTVALVIS2=false;a.ITOTVALVIS3=true;a.ADDCHDBTN=false}else{a.ADDCHDBTN=false}if(this._childnode){a._ModelManagerADMIN.intStatus=i.Modified;a._ModelManagerADMIN.origEntry.CHILD_KEY="0";a._ModelManagerADMIN.origEntry.EXP_LEVEL=a.EXP_LEVEL;a._ModelManagerADMIN.origEntry.IDENT1=r.IDENT_DESCR1;a._ModelManagerADMIN.origEntry.NoofChildnodes=0;a._ModelManagerADMIN.origEntry.ORD=(d.NoofChildnodes+1).toString();a._ModelManagerADMIN.origEntry.PARENT_KEY=a.PARENT_KEY;a._ModelManagerADMIN.origEntry.ITEM_KEY="";a._ModelManagerADMIN.origEntry.RECN="";a._ModelManagerADMIN.origEntry.RECNPARENT="";a._ModelManagerADMIN.origEntry.SUBID=r.SUBID;a._ModelManagerADMIN.origEntry.aCompositions=[];l._ModelManagerADMIN.origEntry.NoofChildnodes=l.NoofChildnodes;a._ModelManagerADMIN.origEntry.ADDCHDBTN=a.ADDCHDBTN;a._ModelManagerADMIN.origEntry.ITOTVALVIS0=a.ITOTVALVIS0;a._ModelManagerADMIN.origEntry.ITOTVALVIS1=a.ITOTVALVIS1;a._ModelManagerADMIN.origEntry.ITOTVALVIS2=a.ITOTVALVIS2;a._ModelManagerADMIN.origEntry.ITOTVALVIS3=a.ITOTVALVIS3;a._ModelManagerADMIN.origEntry.COMPAVG=a.COMPAVG;a._ModelManagerADMIN.origEntry.ACTN=a.ACTN;a._ModelManagerADMIN.origEntry.DELFLG=a.DELFLG;var E=this._childnodepath+"/aCompositions";var I=this._compnewr.getProperty(E);I.push(a);this._compnewr.setProperty(E,I)}else{if(l!=null){a._ModelManagerADMIN.intStatus=i.Modified;a._ModelManagerADMIN.origEntry.CHILD_KEY="0";a._ModelManagerADMIN.origEntry.EXP_LEVEL=1;a._ModelManagerADMIN.origEntry.IDENT1=r.IDENT_DESCR1;a._ModelManagerADMIN.origEntry.ITEM_KEY="";a._ModelManagerADMIN.origEntry.NoofChildnodes=0;a._ModelManagerADMIN.origEntry.ORD=this._compnewr.getData().length.toString();a._ModelManagerADMIN.origEntry.PARENT_KEY=d.PARENT_KEY;a._ModelManagerADMIN.origEntry.RECN="";a._ModelManagerADMIN.origEntry.RECNPARENT="";a._ModelManagerADMIN.origEntry.SUBID=r.SUBID;a._ModelManagerADMIN.origEntry.aCompositions=[];l._ModelManagerADMIN.origEntry.NoofChildnodes=l.NoofChildnodes;a._ModelManagerADMIN.origEntry.ADDCHDBTN=a.ADDCHDBTN;a._ModelManagerADMIN.origEntry.ITOTVALVIS0=a.ITOTVALVIS0;a._ModelManagerADMIN.origEntry.ITOTVALVIS1=a.ITOTVALVIS1;a._ModelManagerADMIN.origEntry.ITOTVALVIS2=a.ITOTVALVIS2;a._ModelManagerADMIN.origEntry.ITOTVALVIS3=a.ITOTVALVIS3;a._ModelManagerADMIN.origEntry.COMPAVG=a.COMPAVG;a._ModelManagerADMIN.origEntry.ACTN=a.ACTN;a._ModelManagerADMIN.origEntry.DELFLG=a.DELFLG;var E="/"+this._compnewr.getData().length;this._compnewr.setProperty(E,a)}else{s.ABS_QTY="";s.ACTN=this.speckey.ACTN;s.ACTN_VP="0";s.ADDCHDBTN=true;s.CHILD_KEY="0";s.COMPAVG="0.0000";s.COMPCAT="COMPONENT";s.COMPNAM="Component";s.COUNTRY_ORIG="";s.DELFLG="";s.ESTCAT=this.estcat;s.EXP_LEVEL=1;s.IDENT1=r.IDENT_DESCR1;s.ITEM_KEY="";s.ITOTVALVIS0=true;s.ITOTVALVIS1=false;s.ITOTVALVIS2=false;s.ITOTVALVIS3=false;s.NoofChildnodes=0;s.ORD="0001";s.PARENT_KEY="0";s.RECN="";s.RECNPARENT="";s.RECNROOT=this.speckey.RECNROOT;s.RECN_VP="";s.ROW_KEY="0000";s.SORTNO="0000";s.SUBID=r.SUBID;s.UOM="";n.intStatus=i.Modified;n.origEntry=s;a._ModelManagerADMIN=n}}this._noddet=l;this._newnode=a;var D=this._oComponent.getODataManager().requestForFetchitmkey();this._oComponent.getODataManager().executeRequest(D,jQuery.proxy(this._fetchrecnsuccess,this))};l.prototype._fetchrecnsuccess=function(e){var t=this._acompsr.getData();this._newnode._ModelManagerADMIN.origEntry.ITEM_KEY=e.results[0].ItemKey;this._newnode.ITEM_KEY=e.results[0].ItemKey;if(this._noddet==null){this._compnewr.setProperty("/0",this._newnode)}else{this._compnewr.setProperty(this._childnodepath,this._noddet)}t.push(this._newnode);this._acompsr.setData(t);this._acompsr.refresh();this._compnewr.refresh();var o=0,r=null;var a=this._compnewr.getData();for(var i=0;i<a.length;i++){if(a[i]!=undefined)o=o+parseInt(a[i].COMPAVG)}if(o<100){r="Warning"}else{r="Success"}o=o+"%";this._obref.setText(o);this._obref.setState(r);this._oDialogadd.control.close()};l.prototype._onSpecSearch=function(e){var t=this._oDialogDialogModel.getProperty("/aData");var o=t[0];o.ESTCAT=this.estcat;var r=this._oComponent.getODataManager().requestForFetchMLCSpecValue(o);this._oComponent.getODataManager().executeRequest(r,jQuery.proxy(this._fetchCharValueSuccess,this))};l.prototype._fetchCharValueSuccess=function(e){this._Odiagrestab.setProperty("/aData",e.entries);this._oDialogDialogModel.setProperty("/AdvSrchPanel1Expanded",false);this._oDialogDialogModel.setProperty("/AdvSrchPanel2Expanded",true)};return l});